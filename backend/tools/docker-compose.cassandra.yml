version: '3.8'
services:
  cassandra:
    image: cassandra:4.1
    container_name: cassandra-local
    ports:
      - "9042:9042"
    environment:
      - CASSANDRA_START_RPC=true
    healthcheck:
      test: ["CMD-SHELL", "cqlsh -e \"describe cluster\" || exit 1"]
      interval: 10s
      timeout: 10s
      retries: 10

  cqlsh:
    image: cassandra:4.1
    depends_on:
      cassandra:
        condition: service_healthy
    entrypoint: ["/bin/sh", "-c", "sleep 1; exec cqlsh cassandra 9042"]
    stdin_open: true
    tty: true
